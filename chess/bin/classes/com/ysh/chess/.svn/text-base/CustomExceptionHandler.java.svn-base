package com.ysh.chess;

import java.lang.Thread.UncaughtExceptionHandler;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.Writer;
import java.io.StringWriter;
import java.io.PrintWriter;

public class CustomExceptionHandler implements  UncaughtExceptionHandler {
    private UncaughtExceptionHandler defaultUEH;

    public CustomExceptionHandler() {

        this.defaultUEH = Thread.getDefaultUncaughtExceptionHandler();
    }

    @Override
    public void uncaughtException(Thread thread, Throwable ex) {
        // TODO Auto-generated method stub
        //System.out.println("应用程序异常");
    	final Writer result = new StringWriter();
    	final PrintWriter printWriter = new PrintWriter(result);
    	ex.printStackTrace(printWriter);
    	String stacktrace = result.toString();
    	printWriter.close();
    	write2file(stacktrace);
        /**
         * 处理异常，保存异常log或向服务器发送异常报告
         */
        defaultUEH.uncaughtException(thread, ex);;
    }
    private void write2file(String stacktrace)
    {
    	try{
    		BufferedWriter bos = new BufferedWriter(new FileWriter("/sdcard/chessdump.txt"));
    		bos.write(stacktrace);
    		bos.flush();
    		bos.close();
    	}catch(Exception e)
    	{
    		e.printStackTrace();
    	}
    }
}
